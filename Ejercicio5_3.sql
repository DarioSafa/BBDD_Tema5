CREATE TABLE PRODUCTO(
CODPRODUCTO NUMBER(5) NOT NULL,
NOMBRE VARCHAR2(40) NOT NULL,
TIPO VARCHAR2(2) NOT NULL,
PRECIOCOSTE NUMBER(5,2) NOT NULL,
PRECIOVENTA NUMBER(5,2) NOT NULL,
IVA NUMBER(2) NOT NULL,
CONSTRAINT pk_PRODUCTO PRIMARY KEY (CODPRODUCTO)
);

CREATE TABLE VENTA(
CODVENTA NUMBER(5) NOT NULL,
FECHA DATE NOT NULL,
CONSTRAINT pk_VENTA PRIMARY KEY(CODVENTA));

CREATE TABLE LINEAVENTA(
CODPRODUCTO NUMBER(5) NOT NULL,
CODVENTA NUMBER(5) NOT NULL,
CANTIDAD NUMBER(2) NOT NULL,
CONSTRAINT pk_lineaventa PRIMARY KEY(CODPRODUCTO,CODVENTA),
CONSTRAINT fk_lineaventa FOREIGN KEY (CODVENTA) REFERENCES VENTA(CODVENTA) ON DELETE CASCADE,
CONSTRAINT fk_linea FOREIGN KEY(CODPRODUCTO) REFERENCES PRODUCTO(CODPRODUCTO) ON DELETE CASCADE
);

--INSERTS VENTA
INSERT INTO VENTA(CODVENTA,FECHA) VALUES(10000,'21/01/2023');
INSERT INTO VENTA(CODVENTA,FECHA) VALUES(10001,'20/02/2023');
INSERT INTO VENTA(CODVENTA,FECHA) VALUES(10002,'16/03/2023');
INSERT INTO VENTA(CODVENTA,FECHA) VALUES(10005,'01/01/2023');
INSERT INTO VENTA(CODVENTA,FECHA) VALUES(10010,'23/02/2023');

--INSERTS PRODUCTO
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50000,'QUESO','L',10.52,25.63,10);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50005,'LECHE','L',10.56,12.55,4);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50010,'HUEVOS','H',26.03,35.20,10);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50015,'CARNE POLLO','C',11.20,40.90,2);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50020,'CARNE TERNERA','C',50.79,64.52,4);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50025,'YOGURT','L',2.56,7.55,10);
INSERT INTO PRODUCTO(CODPRODUCTO,NOMBRE,TIPO,PRECIOCOSTE,PRECIOVENTA,IVA) VALUES (50030,'JUDIAS','V',18.90,20.00,4);

--ARREGLOS PRODUCTO

UPDATE PRODUCTO SET PRODUCTO.CODPRODUCTO = 50010 WHERE PRODUCTO.CODPRODUCTO = 50015;

--INSERTS LINEAVENTA

INSERT INTO LINEAVENTA(CODPRODUCTO,CODVENTA,CANTIDAD) VALUES(50000,10000,2);
INSERT INTO LINEAVENTA(CODPRODUCTO,CODVENTA,CANTIDAD) VALUES(50005,10001,5);
INSERT INTO LINEAVENTA(CODPRODUCTO,CODVENTA,CANTIDAD) VALUES(50010,10002,10);
INSERT INTO LINEAVENTA(CODPRODUCTO,CODVENTA,CANTIDAD) VALUES(50015,10005,11);
INSERT INTO LINEAVENTA(CODPRODUCTO,CODVENTA,CANTIDAD) VALUES(50020,10010,9);

--ARREGLOS LINEA VENTA

DELETE FROM LINEAVENTA WHERE CODPRODUCTO = 50015;

--CONSULTAS

-- a) Mostrar cuántos productos hay cuyo precio de coste sea menor que la mitad del precio de venta.

SELECT COUNT(*) FROM PRODUCTO WHERE PRECIOCOSTE < (PRECIOVENTA/2);

-- b) Mostrar el precio más caro de los productos con IVA 10%

SELECT MAX(PRODUCTO.PRECIOVENTA),MAX(PRODUCTO.PRECIOCOSTE) FROM PRODUCTO WHERE IVA = 10;

-- c) Mostrar el precio más barato de los productos.

SELECT MIN(PRODUCTO.PRECIOVENTA) FROM PRODUCTO;

-- d) Contar cuantos productos de tipo cárnico (Tipo=C) tienen un precio de coste menor que la tercera parte del precio de venta.

SELECT COUNT(*) FROM PRODUCTO WHERE PRODUCTO.PRECIOCOSTE < (PRODUCTO.PRECIOVENTA/3) AND PRODUCTO.TIPO = 'C';

-- e) Mostrar cuánto dinero se pretende ganar con los productos lácteos (tipo = L)

SELECT SUM((PRODUCTO.PRECIOVENTA -PRODUCTO.PRECIOCOSTE)*LINEAVENTA.CANTIDAD) FROM PRODUCTO,LINEAVENTA WHERE PRODUCTO.TIPO = 'L' AND PRODUCTO.CODPRODUCTO = LINEAVENTA.CODPRODUCTO;

--f) Mostrar la media de la ganancia de los productos cuyo tipo es Lácteo (L), Cárnico (C), Verdura (V) y Hortaliza (H).

SELECT AVG((PRODUCTO.PRECIOVENTA -PRODUCTO.PRECIOCOSTE)*LINEAVENTA.CANTIDAD) FROM PRODUCTO,LINEAVENTA WHERE PRODUCTO.TIPO IN ('C','L','V','H') AND PRODUCTO.CODPRODUCTO = LINEAVENTA.CODPRODUCTO;

-- g) Mostrar los precios de coste y de venta con un solo decimal de aquellos productos cuyo nombre empieza por L

SELECT TRUNC(PRODUCTO.PRECIOCOSTE,1), TRUNC(PRODUCTO.PRECIOVENTA,1) FROM PRODUCTO WHERE UPPER(PRODUCTO.NOMBRE) LIKE 'L%';

-- h) Mostrar los precios de coste redondeados con 1 decimal de aquellos productos cuyo precio de venta es solo un 20% más que el de coste y su tipo el H o L

SELECT ROUND(PRODUCTO.PRECIOCOSTE,1) FROM PRODUCTO WHERE  PRODUCTO.PRECIOVENTA > (PRODUCTO.PRECIOCOSTE + (PRODUCTO.PRECIOCOSTE * 0.2)) AND PRODUCTO.TIPO IN ('H','L');

-- i) Mostrar el resto de la división del precio de venta con el de coste para aquellos productos de IVA del 4% y del 10%

SELECT MOD(PRODUCTO.PRECIOVENTA,PRODUCTO.PRECIOCOSTE) FROM PRODUCTO WHERE IVA IN ('4','10');


-- j) Mostrar cuantas ventas se han realizado. Como cada fila que hay en la tabla Venta representa una venta, basta con contar el número de filas que tiene esa tabla.

SELECT COUNT (*) FROM VENTA;

-- k) Mostrar el nombre de los productos de tipo L, transformando su nombre a minúsculas.

SELECT LOWER(PRODUCTO.NOMBRE) FROM PRODUCTO WHERE PRODUCTO.TIPO = 'L';
